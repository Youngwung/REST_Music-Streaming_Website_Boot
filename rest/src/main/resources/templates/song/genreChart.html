<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Rest</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" th:href="@{/css/common.css}">
        <link rel="stylesheet" th:href="@{/css/chart.css}">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
        <style>
	       .container .button_rbox {
	            display: flex;
	            flex-wrap: wrap;
	            gap: 10px;
	        }
	        
	        .container .btn-genre {
	            font-size: 14px;
	            color: #333;
	            border: 1px solid #d7d7d7;
	            background-color: #fff;
	            border-radius: 20px;
	            padding: 8px 16px;
	            transition: all 0.2s ease;
	            cursor: pointer;
	            font-weight: 500;
	        }
	        
	        .container .btn-genre:hover {
	            background-color: #f0f0f0;
	        }
	        
	        .container .btn-genre:focus {
	            outline: none;
	        }
	        
	        .container .btn-genre.active,
	        .container .btn-genre.active:hover,
	        .container .btn-genre.active:focus {
	            color: #fff !important;
	            background-color: #00cd3c !important;
	            border-color: #00cd3c !important;
	        }
	        
	        .container .btn-genre.active:hover {
	            background-color: #00b534 !important;
	        }
	    
	        #noChartMessage {
	            background-color: #f0f2f5; /* 배경색을 좀 더 부드러운 톤으로 변경 */
	            border-radius: 10px;
	            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	            transition: all 0.3s ease;
	            margin: 20px auto; /* 상하 여백 20px, 좌우 여백 자동으로 설정하여 중앙 정렬 */
	            padding: 60px 30px; /* 내부 여백 증가 */
	            width: 100%; /* 부모 요소의 너비에 맞게 설정 */
	            max-width: 1140px; /* 테이블 컨테이너의 최대 너비와 동일하게 설정 */
	            min-height: 50vh;
	            display: flex;
	            flex-direction: column;
	            justify-content: center;
	            align-items: center;
	            box-sizing: border-box; /* 패딩과 보더를 너비에 포함시킴 */
	        }
	        
	        #noChartMessage:hover {
	            transform: translateY(-5px);
	            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
	        }
	        
	        #noChartMessage h3 {
	            color: #3a4a5b; /* 더 진한 색상으로 변경 */
	            font-weight: 600;
	            margin-bottom: 20px;
	            font-size: 2em; /* 글자 크기 증가 */
	        }
	        
	        #noChartMessage p {
	            color: #5a6a7b; /* 본문 텍스트 색상 조정 */
	            font-size: 1.3em; /* 글자 크기 증가 */
	        }
	        
	        @media (max-height: 600px) {
	            #noChartMessage {
	                min-height: 300px;
	            }
	        }
	    </style>
    </head>
    <body>
        <header>
            <th:block th:replace="~{/layout/fragments :: header}"></th:block>
        </header>
        
         
        <main>
            <div class="container my-3">
		        <form id="genreForm" method="get" th:action="@{/song/genreChart}">
		            <div class="d-flex justify-content-start mb-3 button_rbox">
		                <div th:each="genre : ${genres}">
		                    <button type="button" class="btn btn-genre me-2 genre-btn"
		                            th:data-genre-name="${genre}" th:text="${genre}"></button>
		                </div>
		            </div>
		        </form>
		    </div>
		    
		    <div id="noChartMessage" class="text-center py-5" th:classappend="${genreSongs.size() > 0 ? 'd-none' : ''}">
		        <h3 class="text-muted">해당 장르에는 차트가 없습니다</h3>
		        <p class="lead">다른 장르를 선택해 주세요.</p>
		    </div>
        
        
            <div class="container my-3">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllCheckbox" /></th>
                            <th>순위</th>
                            <th>곡 정보</th>
                            <th>앨범</th>
                            <th>좋아요</th>
                            <th>듣기</th>
                            <th>재생목록</th>
                            <th>담기</th>
                            <th>뮤비</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="song, iterStat : ${genreSongs}">
                            <td><input type="checkbox" class="songCheckbox" th:data-song-id="${song.songId}" /></td>
                            <td th:text="${iterStat.index + 1}"></td>
                            <td class="song-info">
                                <a th:href="@{/album/detail(albumId=${song.albumId})}" class="album-link">
                                    <img alt="앨범표지" th:src="@{/images/albumcover/{image}(image=${song.albumImage})}" class="img-fluid" />
                                </a>
                                <div>
                                    <a th:href="@{/song/detail(songId=${song.songId})}" style="font: inherit; color: inherit; text-decoration: none;">
                                        <span th:text="${song.title}"></span><br>
                                    </a>
                                    <th:block th:if="${song.artistNames != null}">
                                        <th:block th:each="artistName, iterStat : ${song.artistNames}">
                                            <a th:href="@{/artist/detail(name=${#strings.trim(artistName)})}" 
                                               th:text="${#strings.trim(artistName)}"
                                               style="color: gray; text-decoration: none;"
                                               onmouseover="this.style.color='#007bff';"
                                               onmouseout="this.style.color='gray';"></a>
                                            <th:block th:if="${!iterStat.last}">, </th:block>
                                        </th:block>
                                    </th:block>
                                    <th:block th:if="${song.artistNames == null or #lists.isEmpty(song.artistNames)}">
                                        <span>정보 없음</span>
                                    </th:block>
                                </div>
                            </td>
                            <td>
                                <a th:href="@{/album/detail(albumId=${song.albumId})}" style="color: gray; text-decoration: none;"
                                   onmouseover="this.style.color='#007bff';"
                                   onmouseout="this.style.color='gray';" class="album-link">
                                    <span class="album-name" th:text="${song.albumName}"></span>
                                </a>
                            </td>
                            <td>
                                <i class="fas fa-heart heart-icon"
							   th:classappend="${song.likes != null && song.likes > 0} ? ' liked' : ''"
							   th:data-song-id="${song.songId}"
							   th:data-user-id="${loginUserId}"></i>
							<span class="likes-count" th:text="${song.likes != null ? song.likes : 0}"></span>
                            </td>
                            <td>
                                <a th:href="@{/songs/{songPath}(songPath=${song.songPath})}">
                                    <button class="btn btn-primary btn-sm play-btn icon-button" 
                                            id="listenBtn"
                                            th:data-song-path="@{/songs/{songPath}(songPath=${song.songPath})}"
                                            th:data-song-id="${song.songId}" 
                                            th:data-id="${song.songId}">
                                        <img alt="듣기" th:src="@{/images/icon/play.png}" />
                                    </button>
                                </a>
                            </td>
                            <td>
                                <button type="button" class="icon-button" id="addCPList"
                                        th:data-id="${song.songId}">
                                    <img alt="재생목록" th:src="@{/images/icon/playList.png}" />
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-secondary btn-sm add-to-playlist-btn icon-button" 
                                        th:data-song-id="${song.songId}">
                                    <img alt="담기" th:src="@{/images/icon/myPlayList.png}" />
                                </button>
                            </td>
                            <td>
                                <th:block th:if="${song.videoLink != null}">
                                    <a th:href="${song.videoLink}" target="_blank" class="icon-button video-link">
                                        <i class="fas fa-video"></i>
                                    </a>
                                </th:block>
                                <th:block th:if="${song.videoLink == null}">
                                    <span>비디오 링크 없음</span>
                                </th:block>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
         
    
        <!-- 플로팅 버튼 그룹 -->
        <div id="floatingButtonGroup" class="floating-button-group d-none">
            <div class="selected-count mb-2">0개 선택됨</div>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary btn-sm play-selected">
                    <img src="/images/icon/play.png" alt="듣기" class="btn-icon"> 듣기
                </button>
                <button type="button" class="btn btn-primary btn-sm add-to-playlist">
                    <img src="/images/icon/playList.png" alt="재생목록" class="btn-icon"> 재생목록
                </button>
                <button type="button" class="btn btn-primary btn-sm add-to-my-list">
                    <img src="/images/icon/myPlayList.png" alt="담기" class="btn-icon"> 담기
                </button>
            </div>
            <button type="button" class="btn btn-secondary btn-sm deselect-all mt-2">선택 해제</button>
        </div>
        
        <!-- 플레이리스트 모달 -->
        <div class="modal fade" id="selectPlayList" tabindex="-1" aria-labelledby="selectPlayListLabel" aria-hidden="true">
           <div class="modal-dialog modal-lg">
               <div class="modal-content">
                   <div class="modal-header">
                       <h5 class="modal-title" id="selectPlayListLabel">플레이리스트 선택</h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                   </div>
                   <div class="modal-body">
                       <div id="playLists" class="playlist-container"></div>
                   </div>
                   <div class="modal-footer">
                       <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                       <button type="button" id="btnAddSong" class="btn btn-primary">곡 추가</button>
                   </div>
               </div>
           </div>
        </div>
        
        <th:block th:replace="~{/layout/fragments :: footer}"></th:block>
        
        <script th:inline="javascript">
            const refresh = /*[[${refresh}]]*/ '';
            const loginUserId = /*[[${loginUserId}]]*/ null;
        </script>
        
        <!-- 우리가 만든 JS 파일 -->
        <script th:src="@{/js/songsByGenre.js}"></script>
        <script th:src="@{/js/addCurrentPlayList.js}"></script>
        
    </body>
</html>
